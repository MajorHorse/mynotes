### 三、IP地址

生成HTTP消息之后，接下来就需要委托操作系统把消息 发送给服务端。但是，在进行这一步之前，我们仍有一个非常重要的步骤需要做：找到服务器在哪里。“找到服务器在哪里”看起来似乎是一句废话，但是它的意义及其背后所用到的底层原理却是非同小可的，关乎着我们身边的这座名为“Internet”的大厦的根基。

提到Internet，我们不妨稍加深入，说一下它到底是什么。从广义上来讲，互联网是基于TCP/IP的思路来设计的：无数个小网络使用路由器连接起来，组成一个大网络；无数个大网络同样使用路由器连接起来，组成一个更大的网络.......以此往后，最终便组成了如今这个“人人互联”的广义上的互联网，就像下图这样。至于TCP/IP协议背后究竟有着什么原理，以后再展开来讲。

![image-20200910192700151](/img/关于DNS--网络是怎样连接的笔记二/image-20200910192700151.png)

就像我们每个人都有唯一的身份证一样，在网络中鉴别我们身份的方法就是IP地址。可以这样说，IP地址 就是我们 每个人在网上冲浪时的身份证。

说到这里，肯定会有人提出疑问：既然IP地址就能唯一的标识出我们在网络上的身份及位置，通信的双方也能通过彼此的IP地址找到对方，那为什么还需要引入域名呢？ 这个问题相信只要上过《计算机网络》这门课的同学都能回答的出来：因为网站是提供给人来访问的，所以需要人能够方便的记住才行。我们ping一下百度的ip地址，可以得到它的域名所对应的额IP地址是[180.101.49.12]，显然，记住一个有明确的意义的由字符所构成的（www.baidu.com）显然比记住一串32比特的数字更简单。

当然，还会有人继续提问：既然如此，那为什么还要用IP呢，直接用域名它不香吗？确实，这是一个大胆但可行的方法。不过，若是互联网中真的使用了这一套规则，那么如今我们访问网站的速度估计会比用IP要慢上几十倍都不止：IP是有固定规则的，一共32位，撑死了也就四个字节。相对应的，域名是由许多个不规则的字符所构成的，最短的也需要几十个字节。我们都知道，目前计算机就算算力再高，充其量也就是个机器而已。若是改用域名，怎么识别出域名都是一个大问题，更不用说由于传输的数据量变大所带来的的带宽压力。所以，域名并不是一个优质的选择。

### 四、如何查询

每个网站在做到能在互联网上被大家访问到之前，必须得先去备案和注册域名。注册域名，实际上就是把我们申请到的域名往DNS服务器里面注册。就像两口子结婚前得去民政局登记一下，拿到一个小红本后别人才能在国家的民政系统里查出来这俩是正儿八经的夫妻似的，域名也一样需要在“民政局”注册一下才行 ，这里的民政局指的就是DNS服务器。全球一共有数万台DNS服务器，这些服务器里面存储着全球所有正经网站的域名。

当然，我们查域名的时候肯定不能把DNS服务器一台一台轮着查，若是这样，估计你输完学习网站的域名按下回车后，等到屏幕上有画面了时，孙子都满月了。所以，我们必须要采取某种策略。说到这里，我们不妨先来看一下域名的具体构成。

实际上，域名也是有着相对严格的格式规范的。以lab.glasscom.com为例，倒数第一个 “.”右边的部分称为顶级域名（也叫作一级域名） ，即com；顶级域名的左边字符串到下个 “.”称为二级域名，即glasscom；二级域名的左边称为三级域名，即lab.......以此类推。而DNS服务器也是按照域名层级来存储域名的：首先将负责下级域名的DNS服务器的IP地址注册到它们的上级DNS服务器中，然后将上级DNS服务器的IP地址注册到更上级的DNS服务器中，以此类推。也就是说，负责管理lab.glasscom.com这个域的DNS服务器的IP地址会注册到glasscom.com域的DNS服务器中，而glasscom.com域的DNS服务器的IP地址又会注册到com域的DNS服务器中。所以，有了这样一种层次关系后，我们就可以顺藤摸瓜，通过上级DNS服务器一层层地查出下级DNS服务器的IP地址。

在现实生活中，我们见到的几乎所有网站都是以.com或者.cn结束的，这样看，莫非.com/.cn就是最顶级的域名？其实不然，.com/.cn上面还有一层域，称为根域。就像www.lab.glasscom.com，它的完整写法其实是www.lab.glasscom.com.。后面还多了一个“.”。这个点就代表着根域。根域中保存着存储顶级域名的DNS服务器的信息，而这样的根域服务器，全球一共才有十几台，其中四台在我们国家（IPV4）。

![image-20200911144346585](/img/关于DNS--网络是怎样连接的笔记二/image-20200911144346585.png)

知道了以上的背景知识后，我们再来看一下根据域名来查找IP地址的具体流程（以lab.glasscom.com为例）。

Step1 客户端计算机向最近的DNS服务器查询（该DNS服务器的IP地址会在建立TCP/IP连接后自动设置好）；

Step2 最近的DNS服务器没有，于是它便会将我们的请求转发给根域服务器（每台DNS服务器中都存储着根域服务器的IP地址）；

Step3 根域服务器收到请求后，发现自己也没有lab.glasscom.com这一域名，但是发现该请求的一级域名com自己存的有。于是，根域服务器便会将存储com域的DNS 服务器的IP地址返回回去，意思是我这里也没有，你去这个服务器找找；

Step4 最近的DNS服务器收到来自根域服务器的返回消息后，便会访问消息里面给的IP。该IP对应的是存储com域的DNS服务器，com域中也没有存储lab.glasscom.com的信息，但是存的有glasscom.com域的信息。同上，其会把存储glasscom.com域的DNS服务器的IP返回去；

以此类推，最终最近的DNS服务器会查找到lab.glasscom.com对应的IP地址并返回给客户端。

这样，也就完成了一次通过DNS服务器查找域名对应的IP地址的基本流程。

![image-20200911145757226](/img/关于DNS--网络是怎样连接的笔记二/image-20200911145757226.png)

