### 一、HTTP协议的无状态性

HTTP协议是一个无状态的协议，即同一个人使用HTTP协议往同一台服务器连续发送两次请求，服务器不能判断第二次发送请求的人和第一次发送请求的人是同一个。要想搞明白HTTP协议为何是无状态的，还要追溯到上个世纪。互联网诞生之初，各种网站什么的基本上都是一些纯静态的页面，用户点击，服务器把页面传过来，也并不需要保存用户的以及会话状态。在那个时代设计的HTTP协议在当时可行，但是放到了现在，简直就是一场灾难。当今的互联网生态圈，Web早已不是几个傻傻的静态页面就能定义的，而是一个实打实的系统。作为一个应用系统，安全性必然是最高等级的要求，所以必须采用一些方法改造HTTP协议，让它变得能“记住并甄别”用户。

### 二、Cookie&Session

#### 1.Cookie的引入

所谓Cookie，本质上就是保存在用户本地的一些数据。既然HTTP协议是无状态的，它没有办法记住我们每次请求的用户信息，所以就有人灵机一动：问什么不把我们已经登录的信息，即用户名和密码在点击后直接保存到本地，然后随着请求一起发送给服务器呢？这样，服务器拿到了数据后，就可以对数据进行操作，来判断请求发起人是谁，请求路径是否合法，从而决定放不放行。这种方法确实是一个优秀的改造方案，但是当用户数量剧增时，其带来的弊端也是显而易见的：用户的每次请求都要把cookie附带着一起发给服务器，这样极大的浪费了服务器的带宽；不仅如此，由于cookie在HTTP请求中是以明文来传输的，所以有些不法分子也就动起了歪脑筋：截获请求，修改cookie信息以达到某种目的。这也就对系统的安全性带来了极大的挑战。所以，Cookie在当今时代，并不能充分的满足需求。

#### 2.Session的引入

和cookie恰恰相反，session是把用户的信息保存在服务端。也就是说服务器的内部会维护一张会话状态表，用户第一次发送登录信息时，服务器会为该用户分配一个SessionID。在请求成功后，服务器会将这个SessionID存入会话状态表中，客户端也会在本地将这个SessionID存入cookie中。这样一来，客户端每次请求都会附上这个SessionID，而服务端在收到请求后，回去查表，判断这个人是谁以及当前的状态。这种方案也很优秀，但是在用户联剧增时，问题同样存在：海量的用户及请求会将服务器的会话状态表变得无比巨大，极大的浪费服务器的资源。

### 三、Token

Cookie和Session在用户量剧增时，都面临着耗费服务器资源的问题：Cookie是耗费请求时的带宽，而Session则是耗费内部资源（内部要维护一张表，存储请求信息）。细想一下这个过程，其实本质上就是一个验证的问题，即我们要确定这个用户之前来过。同时，在做到验证的同时，我们本地也不想存任何东西，因为服务器的资源很宝贵。

解决这个问题的方法就是Token：假设一名用户小A访问了服务器，服务器拿到了小A的数据，然后为其分配一个只有服务器知道的秘钥，并通过一个算法M，将数据和秘钥混在一起进行计算，得出一个签名，然后把这个签名发送给小A，让其保存在本地Cookie中。这个签名就是所谓的Token，在以后的每次请求中，小A都需要把这个签名附加到请求头里面。作为服务端，我们并不需要储存这个签名，只需要在小A每次请求后，拿到他的数据，加上那个只有我们自己才知道的秘钥，再次通过算法M进行计算，若计算出的签名和小A请求时附带的签名一致，	若一致，则说明为同一人。

经过这种方法，服务器不需要存储任何东西，只是做一次运算，极大的节省了开销。